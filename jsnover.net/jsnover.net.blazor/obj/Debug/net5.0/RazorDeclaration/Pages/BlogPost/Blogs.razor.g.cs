// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace jsnover.net.blazor.Pages.BlogPost
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using jsnover.net.blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\VS\jsnover.net\jsnover.net.blazor\_Imports.razor"
using jsnover.net.blazor.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\VS\jsnover.net\jsnover.net.blazor\Pages\BlogPost\Blogs.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\VS\jsnover.net\jsnover.net.blazor\Pages\BlogPost\Blogs.razor"
using Constants;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\VS\jsnover.net\jsnover.net.blazor\Pages\BlogPost\Blogs.razor"
using jsnover.net.blazor.Models;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/Blogs")]
    [Microsoft.AspNetCore.Components.RouteAttribute("/Blogs/{type}/{parameter}")]
    public partial class Blogs : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 172 "C:\VS\jsnover.net\jsnover.net.blazor\Pages\BlogPost\Blogs.razor"
       
    [Parameter]
    public string type { get; set; }

    [Parameter]
    public string parameter { get; set; }

    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    private DataTransferObjects.BlogModels.BlogListModel BlogModels = new DataTransferObjects.BlogModels.BlogListModel();

    private Dictionary<string, List<string>> SearchItems = new Dictionary<string, List<string>>();

    private bool gotSearchItems = false;

    protected override async void OnInitialized()
    {
        if (!SearchIsNull() && BlogModels?.BlogDisplayModels is null)
        {
            BlogModels.BlogDisplayModels = DataTransferObjects.BlogModels.BlogDisplayModel
                    .MapToList(await BlogService.SearchBlogs(type, parameter));
        }
    }

    private bool SearchIsNull()
    {
        return (type is null) || (parameter is null);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (SearchIsNull())
            {
                BlogModels.BlogDisplayModels = await BlogService.GetBlogs();
            }
            BlogModels.BlogDisplayModels = BlogModels.BlogDisplayModels.OrderByDescending(order => order.SubmitDate).ToList();
            this.StateHasChanged();
        }

        if(!gotSearchItems && BlogModels.BlogDisplayModels.Any())
        {
            SearchItems.Add(Keywords.Title, BuildList(Keywords.Title));
            SearchItems.Add(Keywords.Tags, BuildList(Keywords.Tags));
            SearchItems.Add(Keywords.Topic, BuildList(Keywords.Topic));

            gotSearchItems = true;

            this.StateHasChanged();
        }
    }

    private List<string> BuildList(string property)
    {
        var tempList = new List<string>();

        var propList = BlogModels.BlogDisplayModels.Select(blog => blog.GetType().GetProperty(property).GetValue(blog, null)).ToList();

        if (propList?.ElementAt(Keywords.ZeroIndex).GetType().Name is Keywords.ListName)
        {
            foreach (List<Tag> prop in propList)
            {
                tempList.AddRange(prop.Select(tag => tag.Name));
            }
            tempList = tempList.Distinct().ToList();
        }
        else
        {
            tempList.AddRange(propList.Select(prop => prop.ToString()).Distinct().ToList());
        }

        return tempList;
    }

    private Task OnValueChanged(ChangeEventArgs e)
    {
        return ValueChanged.InvokeAsync(e.Value.ToString());
    }

    private void EditBlog(int id)
    {
        nav.NavigateTo($"EditBlog/{id}");
    }

    private void ViewBlog(int id)
    {
        nav.NavigateTo($"blogview/{id}");
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Infrastructure.Services.BlogService BlogService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Blazored.SessionStorage.ISessionStorageService sessionStorage { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager nav { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserManager<IdentityUser> UserManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private SignInManager<IdentityUser> SignInManager { get; set; }
    }
}
#pragma warning restore 1591
